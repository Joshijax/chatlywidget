(function(){"use strict";var e={4506:function(e,t,s){var a=s(9242),o=s(3396),n=s(7139);const i={id:"chat_123876"},r={key:0,class:"loading-div"},c={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},l=(0,o._)("path",{d:"M64 0C28.7 0 0 28.7 0 64V352c0 35.3 28.7 64 64 64h96v80c0 6.1 3.4 11.6 8.8 14.3s11.9 2.1 16.8-1.5L309.3 416H448c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H64z"},null,-1),d=[l],h={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u=(0,o._)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M18.601 8.39897C18.269 8.06702 17.7309 8.06702 17.3989 8.39897L12 13.7979L6.60099 8.39897C6.26904 8.06702 5.73086 8.06702 5.39891 8.39897C5.06696 8.73091 5.06696 9.2691 5.39891 9.60105L11.3989 15.601C11.7309 15.933 12.269 15.933 12.601 15.601L18.601 9.60105C18.9329 9.2691 18.9329 8.73091 18.601 8.39897Z",fill:"white"},null,-1),g=[u];function p(e,t,s,l,u,p){const m=(0,o.up)("chatmaintest");return(0,o.wg)(),(0,o.iD)("div",i,[(0,o.Wm)(a.uT,{name:"bounce"},{default:(0,o.w5)((()=>[(0,o._)("div",{style:(0,n.j5)([u.showPop?"border: 1px solid rgb(242, 242, 242); box-shadow: 6px 2px 15px 5px rgba(0, 0, 0, 0.1);":""])},[u.isLoading?((0,o.wg)(),(0,o.iD)("div",r)):(0,o.kq)("",!0),u.showPop?((0,o.wg)(),(0,o.j4)(m,{key:1,checkFirst:p.checkFirst,onUpdateState:p.updateState,addConversation:p.addConversation,updateConversation:p.updateConversation,removeConversation:p.removeConversation,getConversationBy:p.getConversationBy,showChat:u.showChat,showPop:u.showPop,stateval:u.stateval,user:u.user,unreadMsg:u.unreadMsg,botName:u.botName,onCreateNewConvo:p.createNewConvo,onUpdateUnreadMsg:p.updateUnreadMsg},null,8,["checkFirst","onUpdateState","addConversation","updateConversation","removeConversation","getConversationBy","showChat","showPop","stateval","user","unreadMsg","botName","onCreateNewConvo","onUpdateUnreadMsg"])):(0,o.kq)("",!0)],4)])),_:1}),(0,o._)("div",{class:"chat-icon",onClick:t[0]||(t[0]=e=>p.toggleChat())},[(0,o.Wm)(a.uT,{name:"bounce"},{default:(0,o.w5)((()=>[u.showPop?((0,o.wg)(),(0,o.iD)("svg",h,g)):((0,o.wg)(),(0,o.iD)("svg",c,d))])),_:1})])])}s(7658);var m=s(7795),v=s(36),w=s(1294);const y={apiKey:"AIzaSyCkr7FFrAeCGR1GRo_cUNPyFf5kz8Zm9Ho",authDomain:"chatly-9e73d.firebaseapp.com",projectId:"chatly-9e73d",storageBucket:"chatly-9e73d.appspot.com",messagingSenderId:"692360901272",appId:"1:692360901272:web:f2e46455a122ed050216ed",measurementId:"G-DN2SKEJYP6",storageBucket:""},f=(0,m.ZF)(y);(0,w.cF)(f);function b(){return(0,v.ad)(f)}const k=b(),C=async e=>{const t=(0,v.hJ)(k,"conversation");let s="";try{await(0,v.ET)(t,{step:0,user:e,agent:""}).then((async e=>{s=e.id;(0,v.JU)(k,"conversation",s)}))}catch(a){return!1}return s},I=async(e,t)=>{const s=(0,v.hJ)(k,"conversation");try{await(0,v.r7)((0,v.JU)(s,e),{step:t})}catch(a){console.log(a)}},x=async(e,t)=>{console.log(e,t,"trying to save");const s=(0,v.JU)(k,"conversation",t),a=(0,v.hJ)(s,"chat"),{text:o,type:n,user:i,isUser:r}=e,c={...e,createdAt:(0,v.Bt)()};await(0,v.ET)(a,c).then((async e=>{console.log("Document written with ID: ",e.id),r?(await(0,v.r7)(s,{agentNewmessage:!0,lastMsgTime:(0,v.Bt)()}),console.log("Conversation document updated with agentNewmessage: true")):(await(0,v.r7)(s,{userNewmessage:!0,lastMsgTime:(0,v.Bt)()}),console.log("Conversation document updated with userNewmessage: true"))}))},S=async e=>{const t=await(0,v.QT)((0,v.JU)(k,"conversation",e));if(t.exists())return t.data();console.log("No such document")},M=async e=>{const t=(0,v.JU)(k,"conversation",e),s=(0,v.hJ)(t,"chat"),a=(0,v.IO)(s,(0,v.Xo)("createdAt","desc"),(0,v.b9)(1));let o=await(0,v.QT)((0,v.JU)(k,"conversation",e));o.exists()&&(o=o.data());const n=await(0,v.PL)(a);if(n.docs.length>0){const e=n.docs[0].data();return{lastChatData:e,parentData:o}}return{lastChatData:null,parentData:o}},A=async(e,t)=>{const s=(0,v.JU)(k,"conversation",e);await(0,v.r7)(s,t)},T=async e=>{const t=(0,v.JU)(k,"conversation",e),s=[],a=(0,v.hJ)(t,"chat"),o=(0,v.IO)(a,(0,v.Xo)("createdAt","asc"));await(0,v.r7)(t,{userNewmessage:!1});const n=await(0,v.PL)(o);return n.forEach((e=>{s.push(e.data())})),s},D=async e=>{const t=(0,v.JU)(k,"conversation",e);await(0,v.r7)(t,{userNewmessage:!1})};var _=s(9031),U=s(2689);const N={key:0},B={id:"chatview"},L={class:"chat-container"},j=(0,o._)("div",{class:"chat-header"},[(0,o._)("h3",{class:"h1-chatly1345"},"Chatly")],-1),O={ref:"chatbody",class:"chat-body",id:"chat-body"},P={key:0,class:"loading-div"},E={class:"message-box"},F=(0,o._)("h3",{class:"h1-chatly1345"},"Current conversation",-1),J=(0,o._)("h3",null,"Previous Closed Conversations",-1),q={class:"chat-footer"};function $(e,t,s,n,i,r){const c=(0,o.up)("SingleChat"),l=(0,o.up)("test");return(0,o.wg)(),(0,o.iD)("div",null,[i.showingConvo?((0,o.wg)(),(0,o.j4)(l,{key:1,botName:s.botName,user:s.user,conversationId:i.conversationId,onGoBack:r.goBack,onGoBackTo:r.goBackTo,onCreateNewConvo:r.createNewConvo},null,8,["botName","user","conversationId","onGoBack","onGoBackTo","onCreateNewConvo"])):((0,o.wg)(),(0,o.iD)("div",N,[(0,o._)("div",B,[(0,o.Wm)(a.uT,{name:"bounce"},{default:(0,o.w5)((()=>[(0,o._)("div",L,[j,(0,o._)("div",O,[i.isLoading?((0,o.wg)(),(0,o.iD)("div",P)):(0,o.kq)("",!0),(0,o._)("div",E,[r.activeConversations.length>0?((0,o.wg)(),(0,o.j4)(U.i,{key:0,"item-props":"",lines:"two"},{default:(0,o.w5)((()=>[F,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.activeConversations,(e=>((0,o.wg)(),(0,o.j4)(c,{convo:e,key:e.text,agent:e.agent,user:s.user,onUpdateUnreadMsg:r.updateUnreadMsg,class:"chat-transition",onClick:t=>r.show(e.conversationId)},null,8,["convo","agent","user","onUpdateUnreadMsg","onClick"])))),128))])),_:1})):(0,o.kq)("",!0),r.endedConversations.length>0?((0,o.wg)(),(0,o.j4)(U.i,{key:1,"item-props":"",lines:"two"},{default:(0,o.w5)((()=>[J,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.endedConversations,(e=>((0,o.wg)(),(0,o.j4)(c,{convo:e,key:e.text,agent:e.agent,user:s.user,onUpdateUnreadMsg:r.updateUnreadMsg,class:"chat-transition",onClick:t=>r.show(e.conversationId)},null,8,["convo","agent","user","onUpdateUnreadMsg","onClick"])))),128))])),_:1})):(0,o.kq)("",!0)])],512),(0,o._)("div",q,[r.getCount||i.isLoading?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(_.T,{key:0,onClick:r.createNewConvo,class:"start","aria-details":r.getCount,getCount:""},{default:(0,o.w5)((()=>[(0,o.Uk)(" Start Conversation ")])),_:1},8,["onClick","aria-details"]))])])])),_:1})])]))])}var z=s(6562),R=s(4075),V=s(498);const W={key:0},H={class:"text-primary"};function Z(e,t,s,a,i,r){return e.loaded?((0,o.wg)(),(0,o.iD)("div",W,[(0,o.Wm)(V.l,{title:s.convo.text,subtitle:s.convo.subtitle,"prepend-avatar":r.imageSrc,"append-icon":""},{append:(0,o.w5)((()=>[s.convo.userNewmessage?((0,o.wg)(),(0,o.j4)(z.G,{key:0,color:"green"})):(0,o.kq)("",!0)])),subtitle:(0,o.w5)((({})=>[(0,o._)("span",H,(0,n.zw)(r.capitalizeName("bot"===s.convo.user?"Alex":s.convo.user===s.user?"you":s.agent||"bot")),1),(0,o.Uk)(" â€” "+(0,n.zw)(r.timeAgo(s.convo.createdAt)),1)])),_:1},8,["title","subtitle","prepend-avatar"]),(0,o.Wm)(R.J,{inset:""})])):(0,o.kq)("",!0)}var Y=s(5743),G=s.n(Y),K=s(893),Q=s.n(K);G().extend(Q());var X={data:()=>({loaded:!1}),props:["convo","agent","user"],components:{},methods:{capitalizeName(e){return e.charAt(0).toUpperCase()+e.slice(1)},timeAgo(e){const t=G()(),s=G()(e.toDate());let a=s.diff(t,"second"),o=" ago";if(a=Math.abs(a),a<60)return"Just now";if(a<3600){let e=Math.floor(a/60);return`${e} ${e>1?"minutes":"minute"}${o}`}if(a<86400){let e=Math.floor(a/3600);return`${e} ${e>1?"hours":"hour"}${o}`}{let e=Math.floor(a/86400);return`${e} ${e>1?"days":"day"}${o}`}}},async created(){console.log(this.convo,"the convovov"),this.loaded=!0},computed:{displayAgent(){return"bot"===this.convo.user?"Alex":this.agent||"bot"},imageSrc(){const e=`https://ui-avatars.com/api/?name=${this.displayAgent}&size=40&background=%23ccc&color=fff&color=fff&rounded=true&font-size=0.5`;return e}}},ee=s(89);const te=(0,ee.Z)(X,[["render",Z]]);var se=te,ae=s(2066),oe=s(3289);const ne={id:"chatview"},ie={class:"chat-container"},re={class:"chat-header"},ce={class:"h1-chatly1345"},le={ref:"chatbody",class:"chat-body",id:"chat-body"},de={key:0,class:"loading-div"},he={class:"message-box"},ue=["value"],ge={key:0},pe={class:"name"},me=["innerHTML"],ve={key:1},we=["name","value","id"],ye=["for","onClick"],fe={key:2,class:"just-joined"},be={class:"join-message"},ke={key:3},Ce={key:4},Ie=["onClick"],xe={key:5},Se=["src"],Me={style:{"text-align":"left","margin-bottom":"15px"}},Ae={key:0,id:"loading-bubble"},Te=(0,o._)("div",{class:"spinner"},[(0,o._)("div",{class:"bounce1"}),(0,o._)("div",{class:"bounce2"}),(0,o._)("div",{class:"bounce3"})],-1),De=[Te],_e={key:1},Ue={key:0,style:{position:"relative",width:"fit-content"}},Ne=["src"],Be=(0,o._)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,o._)("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),Le=[Be],je=(0,o._)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,o._)("path",{d:"M5 12H19M19 12L12 5M19 12L12 19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),Oe=[je],Pe=["disabled"],Ee=["src"],Fe=["src"],Je=["aria-controls"],qe=(0,o._)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,o._)("path",{d:"M21.1525 10.8995L12.1369 19.9151C10.0866 21.9653 6.7625 21.9653 4.71225 19.9151C2.662 17.8648 2.662 14.5407 4.71225 12.4904L13.7279 3.47483C15.0947 2.108 17.3108 2.108 18.6776 3.47483C20.0444 4.84167 20.0444 7.05775 18.6776 8.42458L10.0156 17.0866C9.33213 17.7701 8.22409 17.7701 7.54068 17.0866C6.85726 16.4032 6.85726 15.2952 7.54068 14.6118L15.1421 7.01037",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),$e=[qe],ze=["disabled"],Re=(0,o._)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,o._)("path",{d:"M5 12H19M19 12L12 5M19 12L12 19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),Ve=[Re],We=(0,o._)("div",{class:"text"},"Your conversation has ended",-1);function He(e,t,i,r,c,l){const d=(0,o.up)("NewImage"),h=(0,o.up)("inputFields"),u=(0,o.up)("feedBack");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.wy)((0,o._)("div",ne,[(0,o.Wm)(a.uT,{name:"bounce"},{default:(0,o.w5)((()=>[(0,o._)("div",ie,[(0,o._)("div",re,[(0,o.Wm)(oe.t,{style:{cursor:"pointer"},onClick:t[0]||(t[0]=t=>e.$emit("goBack")),start:"",icon:"mdi-arrow-left"}),(0,o._)("h3",ce,"Chatly "+(0,n.zw)(c.agent),1),null!==c.agent?((0,o.wg)(),(0,o.j4)(d,{key:0,name:i.botName,size:"50"},null,8,["name"])):(0,o.kq)("",!0),c.ended||null===c.ended?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(oe.t,{key:1,color:"white",onClick:l.showFeeback,start:"",icon:"mdi-close"},null,8,["onClick"]))]),c.showLoader?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"line-loader",style:(0,n.j5)({width:c.loaderWidth+"%"})},null,4)):(0,o.kq)("",!0),(0,o._)("div",le,[c.isLoading?((0,o.wg)(),(0,o.iD)("div",de)):(0,o.kq)("",!0),(0,o._)("div",he,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(c.messages,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,value:i.user,style:(0,n.j5)([l.checkNxt(e,t)?"":"margin-bottom: 6px;"]),class:(0,n.C_)([e.user===i.user||"user"===e.user?"message-box__item outgoing":"message-box__item incoming"])},["text"===e.type?((0,o.wg)(),(0,o.iD)("div",ge,[(0,o.wy)((0,o._)("div",pe,[e.user!==i.user?((0,o.wg)(),(0,o.j4)(d,{key:0,name:"bot"==e.user?i.botName:e.user,size:20},null,8,["name"])):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,n.zw)(l.capitalizeName("bot"==e.user?i.botName:e.user===i.user?"you":e.user)),1)],512),[[a.F8,l.checkPrev(e,t)]]),(0,o._)("div",{class:(0,n.C_)([e.user===i.user||"user"===e.user?"user-text":"bot-text"])},[(0,o._)("span",{innerHTML:l.renderMessage(e.text)},null,8,me)],2)])):"option"===e.type?((0,o.wg)(),(0,o.iD)("div",ve,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.option,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,style:{"margin-bottom":"5px"}},[(0,o._)("input",{type:"checkbox",name:`name${t}`,value:e.text,id:t},null,8,we),(0,o._)("label",{for:t,class:"md-chip md-chip-clickable md-chip-hover",onClick:t=>l.clickSelect(e)},(0,n.zw)(e.text),9,ye)])))),128))])):(0,o.kq)("",!0),"joined"===e.type?((0,o.wg)(),(0,o.iD)("div",fe,[(0,o._)("span",be,(0,n.zw)(e.text)+" Just joined chat",1)])):"input"===e.type?((0,o.wg)(),(0,o.iD)("div",ke,[(0,o.Wm)(h,{message:e,onHandleInputSubmit:l.handleInputSubmit},null,8,["message","onHandleInputSubmit"])])):"voice"===e.type?((0,o.wg)(),(0,o.iD)("div",Ce,[(0,o._)("button",{onClick:t=>l.playVoiceMessage(e)}," Play voice message ",8,Ie)])):"image"===e.type?((0,o.wg)(),(0,o.iD)("div",xe,[(0,o._)("img",{src:e.text,alt:"",width:"50",height:"50"},null,8,Se)])):(0,o.kq)("",!0)],14,ue)))),128)),(0,o._)("div",Me,[c.isTyping||c.loading?((0,o.wg)(),(0,o.iD)("div",Ae,De)):(0,o.kq)("",!0)])])],512),c.ended?((0,o.wg)(),(0,o.iD)("div",{key:2,class:"chat-footer",style:(0,n.j5)([c.ended?"display: block":""])},[We,(0,o._)("button",{onClick:t[12]||(t[12]=t=>e.$emit("createNewConvo")),class:"start"}," Start Conversation ")],4)):((0,o.wg)(),(0,o.iD)("div",_e,[c.previewImageUrl?((0,o.wg)(),(0,o.iD)("div",Ue,[(0,o._)("img",{src:c.previewImageUrl,style:{"max-width":"100%","max-height":"100px"}},null,8,Ne),(0,o._)("button",{class:"css-2chq30",onClick:t[1]||(t[1]=(...e)=>l.cancelImage&&l.cancelImage(...e)),style:{position:"absolute",top:"5px",right:"-10px"}},Le),(0,o._)("button",{onClick:t[2]||(t[2]=(...e)=>l.sendImage&&l.sendImage(...e)),style:{position:"absolute",bottom:"5px",right:"-10px"}},Oe)])):(0,o.kq)("",!0),c.automated?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",{key:1,class:"chat-footer",style:(0,n.j5)([c.ended?"display: block":""])},[(0,o.wy)((0,o._)("textarea",{rows:"1",ref:"message",disabled:c.automated,"onUpdate:modelValue":t[3]||(t[3]=e=>c.newMessage=e),onKeyup:[t[4]||(t[4]=(0,a.D2)(((...e)=>l.sendMessage&&l.sendMessage(...e)),["enter"])),t[6]||(t[6]=(...e)=>l.onTyping&&l.onTyping(...e))],onKeydown:t[5]||(t[5]=(0,a.D2)((0,a.iM)(((...e)=>l.insertNewLine&&l.insertNewLine(...e)),["shift","prevent"]),["enter"])),type:"text",placeholder:"Type a message...",style:{"max-height":"calc(3 * (1.5em + 2px))"}},null,40,Pe),[[a.nr,c.newMessage]]),c.recording?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("img",{key:0,src:s(9252),onClick:t[7]||(t[7]=(...e)=>l.startRecording&&l.startRecording(...e)),class:"recordingIcon footIcon"},null,8,Ee)),c.recording?((0,o.wg)(),(0,o.iD)("img",{key:1,src:s(8538),onClick:t[8]||(t[8]=(...e)=>l.stopRecording&&l.stopRecording(...e)),class:"recordingIcon footIcon"},null,8,Fe)):(0,o.kq)("",!0),(0,o._)("input",{ref:"fileInput",type:"file",accept:"image/*",onChange:t[9]||(t[9]=(...e)=>l.handleFileUpload&&l.handleFileUpload(...e)),style:{display:"none"}},null,544),(0,o._)("button",{"aria-controls":e.$refs.fileInput,onClick:t[10]||(t[10]=t=>e.$refs.fileInput.click()),"aria-label":"Attach file",class:"footIcon"},$e,8,Je),(0,o._)("button",{class:"footButton",disabled:""===c.newMessage,onClick:t[11]||(t[11]=(...e)=>l.sendMessage&&l.sendMessage(...e))},Ve,8,ze)],4))]))])])),_:1})],512),[[a.F8,!c.feedback]]),(0,o.wy)((0,o.Wm)(u,{onGetConversationBy:l.getConversationBy,onUpdateConversation:l.updateConversation,conversationId:i.conversationId,onGoBack:t[13]||(t[13]=e=>c.feedback=!1),onGoBackTo:t[14]||(t[14]=t=>e.$emit("goBackTo"))},null,8,["onGetConversationBy","onUpdateConversation","conversationId"]),[[a.F8,c.feedback]])])}const Ze={ref:"canvas"};function Ye(e,t,s,a,n,i){return(0,o.wg)(),(0,o.iD)("canvas",Ze,null,512)}var Ge={props:{name:String,size:{type:Number,default:40}},mounted(){const e=this.$refs.canvas,t=e.getContext("2d"),s=this.size,a=s/2,o="Arial";e.width=s,e.height=s,t.fillStyle="#ccc",t.fillRect(0,0,s,s),t.fillStyle="#fff",t.textAlign="center",t.textBaseline="middle",t.font=`${a}px ${o}`,t.fillText(this.getNameInitial(),s/2,s/2)},methods:{getNameInitial(){return this.name?this.name[0].toUpperCase():"B"}},watch:{name:function(e,t){console.log(e,"there was a chnage");const s=this.$refs.canvas,a=s.getContext("2d"),o=40,n=o/2,i="Arial";s.width=o,s.height=o,a.fillStyle="#ccc",a.fillRect(0,0,o,o),a.fillStyle="#fff",a.textAlign="center",a.textBaseline="middle",a.font=`${n}px ${i}`,a.fillText(this.getNameInitial(),o/2,o/2)}}};const Ke=(0,ee.Z)(Ge,[["render",Ye]]);var Qe=Ke,Xe=s(6119),et=s(6422),tt=s(2013),st=s(6195);const at={id:"chatview"},ot={class:"chat-container"},nt={class:"chat-header"},it=(0,o._)("h3",null,"Chatly",-1),rt={ref:"chatbody",class:"chat-body",id:"chat-body",style:{display:"flex","justify-content":"center","align-items":"center"}},ct={key:0,class:"loading-div"},lt={style:{"max-width":"360px"},class:""},dt=(0,o._)("h3",{style:{"text-align":"center"}}," Please tell us how was your experience? ",-1),ht={class:"emoji"},ut={class:"tooltip-value"},gt=(0,o._)("div",{class:"chat-footer"},null,-1);function pt(e,t,s,i,r,c){const l=(0,o.up)("ErrorDialog");return(0,o.wg)(),(0,o.iD)("div",at,[(0,o.Wm)(a.uT,{name:"bounce"},{default:(0,o.w5)((()=>[(0,o._)("div",ot,[(0,o._)("div",nt,[(0,o.Wm)(oe.t,{style:{cursor:"pointer"},onClick:t[0]||(t[0]=t=>e.$emit("goBack")),start:"",icon:"mdi-arrow-left"}),it]),(0,o._)("div",rt,[r.isLoading?((0,o.wg)(),(0,o.iD)("div",ct)):(0,o.kq)("",!0),(0,o._)("div",lt,[(0,o.Wm)(et.O,{ref:"form",onSubmit:(0,a.iM)(c.submitFeedback,["prevent"])},{default:(0,o.w5)((()=>[dt,(0,o.Wm)(Xe.f,{modelValue:r.selectedEmoji,"onUpdate:modelValue":t[1]||(t[1]=e=>r.selectedEmoji=e),mandatory:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.emojis,(e=>((0,o.wg)(),(0,o.j4)(_.T,{key:e.value,value:e.value,class:"ma-2 custom-btn"},{default:(0,o.w5)((()=>[(0,o._)("span",ht,(0,n.zw)(e.label),1),(0,o.Wm)(st.N,{top:""},{default:(0,o.w5)((()=>[(0,o._)("span",ut,(0,n.zw)(e.value),1)])),_:2},1024)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"]),(0,o.Wm)(tt.h,{modelValue:r.comments,"onUpdate:modelValue":t[2]||(t[2]=e=>r.comments=e),label:"Additional Comments",rules:r.rules.comments},null,8,["modelValue","rules"]),(0,o.Wm)(_.T,{color:"blue",onClick:(0,a.iM)(c.submitFeedback,["prevent"]),disabled:null===r.selectedEmoji},{default:(0,o.w5)((()=>[(0,o.Uk)("Submit")])),_:1},8,["onClick","disabled"])])),_:1},8,["onSubmit"])])],512),gt])])),_:1}),e.showErrorDialog?((0,o.wg)(),(0,o.j4)(l,{key:0,error:e.errorMessage,onDismiss:e.hideErrorDialog},null,8,["error","onDismiss"])):(0,o.kq)("",!0)])}var mt={data(){return{selectedEmoji:null,comments:"",isLoading:!1,emojis:[{value:"bad",label:"ðŸ˜ "},{value:"fair",label:"ðŸ˜•"},{value:"good",label:"ðŸ˜Š"},{value:"great",label:"ðŸ˜„"}],rules:{comments:[e=>!!e||"Comments are required",e=>e.length<=1e3||"Comments must be less than 1000 characters"]}}},components:{},props:["conversationId"],methods:{async updateConversation(e,t){const s=JSON.parse(localStorage.getItem("appState")),a={...s,conversations:{...s.conversations,byId:{...s.conversations.byId,[e]:{...s.conversations.byId[e],...t}}}};console.log(a,"updateing feedback"),localStorage.setItem("appState",JSON.stringify(a))},getConversationBy(e){const t=JSON.parse(localStorage.getItem("appState")),s=t.conversations.byId;return s.hasOwnProperty(e)?s[e]:null},async submitFeedback(){if(this.$refs.form.validate()){await A(this.conversationId,{ended:!0,comment:this.comments,reaction:this.selectedEmoji});let e=this.getConversationBy(this.conversationId);console.log("the item",e),e.ended=!0,await this.updateConversation(this.conversationId,e),this.$emit("goBackTo")}}},created(){}};const vt=(0,ee.Z)(mt,[["render",pt]]);var wt=vt,yt=s(4161);const ft=["aria-valuetext"],bt={class:"input-placeholder"},kt={class:"input-container"},Ct=["onSubmit"],It=["type","aria-label"],xt={key:0,type:"submit","aria-label":"Submit",tabindex:"0"},St=(0,o._)("span",{"aria-hidden":"true",class:""},[(0,o._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[(0,o._)("path",{d:"M5.42773 4.70898C5.46387 4.85254 5.53809 4.98828 5.65039 5.10059L8.54932 8L5.64893 10.9004C5.31689 11.2324 5.31689 11.7705 5.64893 12.1025C5.98096 12.4336 6.51904 12.4336 6.85107 12.1025L10.3516 8.60059C10.5591 8.39355 10.6367 8.10449 10.585 7.83691C10.5537 7.67578 10.4761 7.52246 10.3516 7.39844L6.85254 3.89941C6.52051 3.56738 5.98242 3.56738 5.65039 3.89941C5.43066 4.11816 5.35645 4.42871 5.42773 4.70898Z",fill:"#ffffff"})])],-1),Mt=[St],At=["aria-valuetext"],Tt={class:"input-placeholder"},Dt={class:"input-container"},_t=["type","value","aria-label"];function Ut(e,t,s,i,r,c){return s.message.saved?((0,o.wg)(),(0,o.iD)("div",{key:1,"aria-valuetext":s.message.saved},[((0,o.wg)(),(0,o.iD)("div",{key:e.index,class:"input-div"},[(0,o._)("div",Tt,(0,n.zw)(c.capitalizeName(s.message.placeholder)),1),(0,o._)("div",Dt,[(0,o._)("input",{disabled:"",required:"",type:s.message.type,autocomplete:"off",value:s.message.value,"aria-label":s.message.placeholder},null,8,_t)])]))],8,At)):((0,o.wg)(),(0,o.iD)("div",{key:0,"aria-valuetext":s.message.saved},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.message.inputs,((i,r)=>((0,o.wg)(),(0,o.iD)("div",{key:r,class:"input-div"},[(0,o._)("div",bt,(0,n.zw)(c.capitalizeName(i.placeholder))+" "+(0,n.zw)(s.message.saved),1),(0,o._)("div",kt,[(0,o._)("form",{onSubmit:(0,a.iM)((e=>c.handleInputSubmit(i.placeholder,i.id)),["prevent"])},[(0,o.wy)((0,o._)("input",{required:"",type:i.type,autocomplete:"off",value:"","aria-label":i.placeholder,ref_for:!0,ref:"qInput","onUpdate:modelValue":t[0]||(t[0]=t=>e.inputField=t)},null,8,It),[[a.YZ,e.inputField]]),i?((0,o.wg)(),(0,o.iD)("button",xt,Mt)):(0,o.kq)("",!0)],40,Ct)])])))),128))],8,ft))}var Nt={data:()=>({inputField:"",placeholder:""}),props:["message"],methods:{async handleInputSubmit(e,t){console.log(this.inputField,e);const s=`My ${e} is: ${this.inputField}`;console.log(this.message,this.inputField,s),this.$emit("handleInputSubmit",{id:t,msg:this.message,inputValue:this.inputField,value:s})},capitalizeName(e){}}};const Bt=(0,ee.Z)(Nt,[["render",Ut]]);var Lt=Bt,jt=document.querySelector('audio[src$="incoming.mp3"]'),Ot=document.querySelector('audio[src$="outgoing.mp3"]'),Pt={name:"chatView",data(){return{feedback:!1,socket:null,automated:!0,loading:!1,showErrorDialog:!0,isLoading:!1,errorMessage:"Error Message",showChat:!1,agent:null,ip:"",newMessage:"",isTyping:!1,joined:!1,typingMsg:"",step:0,messages:[],chatTimeout:null,chatTimeoutDuration:3e5,chatStartTime:null,loaderWidth:0,intervalIds:[],showLoader:!1,convoEnded:!1,isBotEnabled:!0,ended:null,selectedFile:null,flow:[{step:0,next:!0,auto:!0,messages:[{text:"Hi! I'm glad to assist you today. Let's know each other:",user:"bot",type:"text"},{text:"Do you have an order already?",user:"bot",type:"text"},{user:"user",option:[{id:1.01,text:"Yes"},{id:2,text:"No"}],type:"option"}]},{step:1.01,next:!0,auto:!0,messages:[{text:"Please can we know this: ",user:"bot",type:"text"},{user:"user",inputs:[{id:1.02,type:"email",placeholder:"email address"}],type:"input"}]},{step:1.02,next:!0,auto:!0,messages:[{user:"user",inputs:[{id:1,type:"number",placeholder:"Order Id"}],type:"input"}]},{step:1,next:!0,auto:!0,messages:[{text:"Please select what you want to do with the order",user:"bot",type:"text"},{user:"user",option:[{id:1.1,text:"i want to make a return/swap"},{id:1.2,text:"I want to know the order status"},{id:1.3,text:"Others"}],type:"option"}]},{step:1.1,next:"end",auto:!1,messages:[{text:"You can easly Return or swap an order here: <a href='https://site.com/return' target='_blank'>https://site.com/return</a> ",user:"bot",type:"text"}]},{step:1.2,next:"end",auto:!1,messages:[{text:"You can track your order here: <a href='https://site.com/tracking' target='_blank'>https://site.com/tracking</a>",user:"bot",type:"text"}]},{step:1.3,next:"end",auto:!1,messages:[{text:"Tell us how else can we help?",user:"bot",type:"text"}]},{step:2,next:!0,auto:!0,messages:[{text:"What would you like to do?",user:"bot",type:"text"},{user:"user",option:[{id:2.1,text:"Place a new order"},{id:2.2,text:"I have a question"},{id:2.3,text:"Others"}],type:"option"}]},{step:2.1,next:"end",auto:!1,messages:[{text:"What products do you want?",user:"bot",type:"text"}]},{step:2.2,next:"end",auto:!1,messages:[{text:"You can ask any question, we are here for you",user:"bot",type:"text"}]},{step:2.3,next:"end",auto:!1,messages:[{text:"What other thing do you want us to do for you?",user:"bot",type:"text"}]}],newMessage:"",recording:!1,mediaRecorder:null,previewImageUrl:null}},components:{NewImage:Qe,feedBack:wt,inputFields:Lt},props:["addConversation","user","updateConversation","getConversationBy","botName","createNewConvo","conversationId"],methods:{handleFileUpload(e){this.selectedFile=e.target.files[0];const t=new FileReader;t.onload=e=>{this.previewImageUrl=e.target.result},t.readAsDataURL(this.selectedFile)},async sendImage(){const e={conversationId:this.conversationId,username:this.user,type:"image",message:this.previewImageUrl,isUser:!0};this.socket.emit("image",e);const t={text:this.previewImageUrl,type:"image",user:this.user,isUser:!0,conversationId:this.conversationId};this.messages.push(t)},cancelImage(){this.selectedFile=null,this.previewImageUrl=null},insertNewLine(e){if(e.shiftKey){const t=this.$refs.message,s=t.selectionStart,a=t.selectionEnd,o=this.newMessage;this.newMessage=`${o.substring(0,s)}\n${o.substring(a)}`,e.preventDefault()}},showFeeback(){this.feedback=!0},async joinConversation(e){this.ended||(this.socket.emit("join",{id:e,user:this.user}),this.joined=!0)},async sendMessage(){if(""===this.newMessage)return;const e={text:this.newMessage};await this.socket.emit("message",{conversationId:this.conversationId,type:"text",username:this.user,message:e,isUser:!0}),this.socket.emit("typing",{status:!1,user:this.user,id:this.conversationId}),this.chatStartTime=Date.now(),localStorage.setItem("chatStarted",!0),localStorage.setItem(`chatStartTime-${this.conversationId}`,this.chatStartTime),this.resetChatTimeout(),this.newMessage=""},onTyping(){this.isTyping||(this.socket.emit("typing",{status:!0,user:this.user,id:this.conversationId}),setTimeout((()=>{this.socket.emit("typing",{status:!1,user:this.user,id:this.conversationId})}),2e3))},checkPrev(e,t){return 0===t||this.messages[t-1].user!==e.user},checkNxt(e,t){if(0===t)return!0;const s=this.messages.length-1,a=this.messages.indexOf(e);return a===s||this.messages[t+1].user!==e.user},async newMessageSound(e){e.play();let t=document.title;document.title=newTitle,setTimeout((function(){document.title=t}),2e3)},async clickSelect(e){this.newMessageSound(Ot),this.loading=!0,this.messages.pop();const t={id:e.id,text:e.text,user:this.user,type:"text",isUser:!0};this.messages=[...this.messages,t],this.loading=!0,console.log(this.step,"this step"),await this.checkCase(this.step,!0,t,!1),await this.checkCase(this.step,!1,t,!1),this.newMessageSound(jt),this.chatToChatbottom(),this.loading=!1},async handleInputSubmit(e){const{msg:t,inputValue:s,value:a,id:o}=e;this.newMessageSound(Ot),this.loading=!0,this.messages.pop(),console.log(o,"joshjiax");const n={id:o,text:a,value:s,type:"input",user:this.user,isUser:!0,saved:!0};console.log(n),this.messages=[...this.messages,n],console.log(this.step,"this step"),await this.checkCase(this.step,!0,n,!1),await this.checkCase(this.step,!1,n,!1),this.newMessageSound(jt),this.chatToChatbottom(),this.loading=!1},async checkCase(e,t,s,a){console.log(e,t,s);let o=this.flow.find((t=>t.step===e));if("end"===o.next&&a){if(!o.auto){this.isSocketInConversation(),this.automated=!1}this.chatToChatbottom()}else{if(t){o.messages.pop();for(let e=0;e<o.messages.length;e++){const t=o.messages[e];t.isUser=!0,await this.saveMessage(t,this.conversationId)}await x(s,this.conversationId),await I(this.conversationId,s.id),this.step=s.id}if(!t){for(let e=0;e<o.messages.length;e++){const t=o.messages[e];t.isUser=!0,this.messages.push(t),"end"!==o.next&&o.auto||await this.saveMessage(t,this.conversationId),this.chatToChatbottom()}"end"!==o.next||o.auto||(await this.stopAutomate(),await this.sendToBot())}}},async chatToChatbottom(){if(document.querySelector("#chatly-app").shadowRoot.querySelector("#chat-body")){const e=document.querySelector("#chatly-app").shadowRoot.querySelector("#chat-body");e.scrollTop=e.scrollHeight}},async saveMessage(e,t){const s={text:e.text,type:e.type,user:e.user,isUser:!0};await x(s,t)},requestAssistance(){if(!this.agent&&!this.ended){const e={conversationId:this.conversationId,userId:this.user};this.socket.emit("requestAssistance",e);localStorage.getItem("chatStarted");this.showLoader=!0}},async stopAutomate(){this.joinConversation(this.conversationId),this.automated=!1,this.chatToChatbottom(),this.requestAssistance()},isSocketInConversation(){const e=`conversation:${this.conversationId}`;this.socket.emit("isSocketInConversation",e,(e=>{e||this.joinConversation(this.conversationId)}))},async lastMessageIsBot(){const e=this.messages[this.messages.length-1];return"voice"===e.type||e&&"bot"===e.user},startChatTimeout(){const e=Date.now()-this.chatStartTime,t=Math.max(this.chatTimeoutDuration-e,0);this.chatTimeout=setTimeout((()=>{this.ended||this.socket.emit("timeUp",this.conversationId),this.expiredConvId(!0)}),t);const s=setInterval((()=>{const e=Date.now()-this.chatStartTime,t=Math.max(this.chatTimeoutDuration-e,0),s=t/this.chatTimeoutDuration*100;this.loaderWidth=100-s}),1e3);this.intervalIds.push(s)},resetChatTimeout(){clearTimeout(this.chatTimeout),this.chatStartTime||(this.chatStartTime=Date.now()),this.startChatTimeout(),clearInterval(this.intervalIds.pop()),this.loaderWidth=0},getConversationById(e){const t=JSON.parse(localStorage.getItem("appState"))||{},s=t.conversations?.byId[e]||null;return s},getConversationIdFromLocalStorage(){const e=localStorage.getItem("conversationId");if(e){const t=e.split("-")[0];return t}return null},saveConversationId(e){const t=Date.now(),s={fetchState:"partial",read:!0,expire:t};this.addConversation(e,s)},isConversationIdExpired(){const e=this.conversationId||this.conversationId,t=this.getConversationById(e);if(e&&t){const e=parseInt(t.expire),s=Date.now(),a=6048e5;return s-e>a}return!0},async expiredConvId(e){this.isConversationIdExpired()},async getConversationId(){let e=this.conversationId||null;return null===e&&this.$router.push({name:"home"}),e},capitalizeName(e){return e.charAt(0).toUpperCase()+e.slice(1)},iniStartTime(){this.chatStartTime=localStorage.getItem(`chatStartTime-${this.conversationId}`),this.chatStartTime&&(this.showLoader=!0,this.startChatTimeout()),this.chatStartTime||(this.chatStartTime=Date.now(),localStorage.setItem(`chatStartTime-${this.conversationId}`,this.chatStartTime))},async updateConversation(e,t){const s=JSON.parse(localStorage.getItem("appState")),a={...s,conversations:{...s.conversations,byId:{...s.conversations.byId,[e]:{...s.conversations.byId[e],...t}}}};localStorage.setItem("appState",JSON.stringify(a))},getConversationBy(e){const t=JSON.parse(localStorage.getItem("appState")),s=t.conversations.byId;return s.hasOwnProperty(e)?s[e]:null},async sendToBot(){let e=await this.lastMessageIsBot();if(e||this.automated)return this.sending=!1,void(this.isTyping=!1);this.sending=!0,this.isTyping=!0;let t=this.messages.filter((e=>"text"===e.type||"input"===e.type)),s=t.map((e=>"\n"+e.text)),a=" \nhello\n "+s.join("");console.log(a,"TEXT"),this.inputText="";try{const e=await(0,yt.Z)({method:"post",url:"http://54.162.89.39/answer-me/",data:{prompt:a}});await this.socket.emit("message",{conversationId:this.conversationId,type:"text",username:"bot",message:{text:e.data.response},isUser:!1}),this.isTyping=!1}catch(o){this.isTyping=!1}this.sending=!1},messageEndsWithGoodbye(e){if(!e)return!1;const t=["goodbye","bye","farewell","see you","take care","have a nice","later"],s=[/\b(thanks|thank you)\b/gi,/\b(good night|night)\b/gi,/\b(talk to you|chat with you)\b/gi,/\b(see you|cu|ttyl|ttys)\b/gi,/\b(be safe)\b/gi,/\b(have a great|have a nice)\b/gi,/\b(take care)\b/gi,/\b(sleep well)\b/gi,/\b(catch you later|laters)\b/gi];for(const a of t)if(e.toLowerCase().includes(a))return!0;for(const a of s)if(a.test(e))return!0;return!1},renderMessage(e){const t=/(https?|ftp):\/\/[^\s]+/gi;return this.isLink(e)&&(e=e.replace(t,'<a href="$&" target="_blank">$&</a>')),e},isLink(e){const t=/^(?!.*?<a\s).*?(https?|ftp):\/\/[^\s]+.*$/i;return t.test(e)},async iniChat(){this.isLoading=!0;let e={};if(e=await S(this.conversationId),this.agent=e.agent,this.messages=await T(this.conversationId),console.log("glory",e,this.messages),this.step=e.step,await this.expiredConvId(!1),this.chatToChatbottom(),this.iniStartTime(),this.isLoading=!1,e.hasOwnProperty("ended")){this.ended=e.ended;let t=this.getConversationBy(this.conversationId);t.ended=e.ended,await this.updateConversation(this.conversationId,t)}else this.ended=!1;if(await this.checkCase(this.step,!1,null,!0),!this.ended&&this.isBotEnabled&&!this.automated){let e=await this.lastMessageIsBot();e||this.sendToBot()}},recordingAudio(){this.recording=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{this.mediaRecorder=new MediaRecorder(e);const t=[];this.mediaRecorder.addEventListener("dataavailable",(e=>{t.push(e.data)})),this.mediaRecorder.addEventListener("stop",(()=>{this.recording=!1;const e=new Blob(t,{type:"audio/webm"}),s=new FileReader;s.readAsDataURL(e);const a=this.conversationId;console.log("sending audio",a),s.addEventListener("loadend",(()=>{console.log("sending audio",a);const e={conversationId:a,username:this.user,type:"voice",author:"Me",message:s.result,isUser:!0};this.messages.push(e)}))})),this.mediaRecorder.start()}))},requestMicrophonePermission(){navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{this.mediaStream=e,this.startRecording()})).catch((e=>{console.error(e)}))},startRecording(){navigator.permissions&&navigator.permissions.query({name:"microphone"}).then((e=>{"granted"===e.state?this.recordingAudio():"prompt"===e.state?navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{e.getTracks().forEach((e=>e.stop())),this.recordingAudio()})).catch((e=>{console.error(e)})):"denied"===e.state&&console.error("Permission denied for microphone")}))},stopRecording(){this.mediaRecorder.stop()},playVoiceMessage(e){const t=new Audio(e.text),s=document.createElement("button");s.textContent="Play",s.onclick=()=>{t.play()},s.click()}},async created(){this.socket=(0,ae.ZP)("http://18.212.173.184:3000/"),this.socket.on("connect",(()=>{this.socket.emit("userType","customer")})),this.socket.on("newMessage",(async e=>{console.log(e.user,this.user),e.user===this.user||"user"===e.user?(await this.messages.push(e),await this.chatToChatbottom(),await this.newMessageSound(Ot),this.isBotEnabled&&this.sendToBot()):(this.messages.push(e),this.chatToChatbottom(),this.newMessageSound(jt),D(this.conversationId))})),this.socket.on("joined",(async e=>{this.user!=e.user&&this.agent!==e.user&&(this.messages.push(e),await this.chatToChatbottom())})),this.socket.on("typing",(e=>{this.isTyping=e.status,this.typingMsg=`${e.user} is typing`,this.chatToChatbottom()})),this.socket.on("requestAccepted",(async e=>{this.agent=e.userId})),await this.iniChat()},beforeUnmount(){this.socket.off()},watch:{messages:{handler(e){const t=e[e.length-1];t&&this.messageEndsWithGoodbye(t.text)&&null!==this.ended&&!this.ended&&setTimeout((()=>{this.showFeeback()}),3e3)},deep:!0},conversationId:{async handler(e,t){await this.iniChat()},immediate:!0}},computed:{displayAgent(){return this.agent||"bot"}}};const Et=(0,ee.Z)(Pt,[["render",He]]);var Ft=Et,Jt={data(){return{socketMainpage:null,chatActive:!1,isLoading:!1,conversations:[],showingConvo:!1,conversationId:"",state:null}},props:["showPop","addConversation","user","botName","stateval"],components:{SingleChat:se,test:Ft},methods:{show(e){this.conversationId="",this.conversationId=e,this.showingConvo=!0;const t=JSON.parse(localStorage.getItem("appState"));this.state=t;const s={...this.state,state:{...this.state.state,page:{name:"conversation",id:e}}};this.$emit("updateState",s)},async goBack(){this.showingConvo=!1,await this.init(),this.$forceUpdate();const e=JSON.parse(localStorage.getItem("appState"));this.state=e;const t={...this.state,state:{...this.state.state,page:{name:"home",id:null}}};this.$emit("updateState",t)},async goBackTo(){this.showingConvo=!1,await this.init(),this.$forceUpdate()},updateUnreadMsg(){this.$emit("updateUnreadMsg")},async saveConversationId(e){const t=Date.now(),s={fetchState:"partial",read:!0,expire:t,ended:!1};this.addConversation(e,s)},handleNewMessage(e){const t=this.conversations.findIndex((t=>t.conversationId===e.conversationId));if(t>-1){const s=this.conversations[t];s.text=e.text,s.userNewmessage=!0,s.createdAt=e.createdAt,this.conversations.splice(t,1,s)}},async getAllInfo(e){const t=await M(e);let s,a=await t.parentData.userNewmessage||!1,o=await t.lastChatData;return null===t.lastChatData?o={text:"hello message",user:"Bot",createdAt:v.EK.now()}:"voice"===t.lastChatData.type?o={text:"voice Message",user:t.lastChatData.user,createdAt:t.lastChatData.createdAt}:"image"===t.lastChatData.type&&(o={text:"Image",user:t.lastChatData.user,createdAt:t.lastChatData.createdAt}),s=!!t.parentData.hasOwnProperty("ended")&&t.parentData.ended,{conversationId:e,text:o.text,user:o.user,agent:t.parentData.agent,ended:s,userNewmessage:a,createdAt:o.createdAt}},async createNewConvo(){console.log("click"),this.isLoading=!0;const e=JSON.parse(localStorage.getItem("appState")),t=e.conversations.byId,s=Object.keys(t).pop(),a=Object.values(t).pop(),o=!a||a.ended;if(o){this.isLoading=!0;let e=await C(this.user);await this.saveConversationId(e),this.isLoading=!1,this.show(e)}else this.show(s),this.isLoading=!1},isConversationIdExpired(){const e=localStorage.getItem("conversationId");if(e){const t=parseInt(e.split("-")[1]),s=Date.now(),a=6048e5;return s-t>a}return!0},async init(){const e=JSON.parse(localStorage.getItem("appState")),t=e.conversations.byId,s=[];for(const n in t){const e={...t[n],id:n};s.push(e)}const a=s.reverse(),o=a.slice(0,3);for(let n=0;n<o.length;n++){const e=o[n];let t=await this.getAllInfo(e.id);const s=this.conversations.findIndex((e=>e.conversationId===t.conversationId));-1!==s?this.conversations[s]=t:this.conversations.push(t)}console.log(this.conversations,"this is fine"),o.length>0&&this.socketMainpage.emit("join",{id:o[0].id,user:this.user}),this.isLoading=!1}},async created(){this.isLoading=!0,this.socketMainpage=(0,ae.ZP)("http://18.212.173.184:3000/"),this.socketMainpage.on("connect",(()=>{})),this.socketMainpage.on("newMessage",(e=>{e.createdAt=v.EK.now(),this.handleNewMessage(e)}));const e=JSON.parse(localStorage.getItem("appState"));e&&"conversation"===e.state.page.name&&(this.conversationId=e.state.page.id,this.showingConvo=!0),await this.init()},computed:{sortedConversations(){return this.conversations.slice().sort(((e,t)=>t.createdAt.seconds-e.createdAt.seconds))},activeConversations(){return this.conversations.filter((e=>!e.ended))},endedConversations(){return this.conversations.filter((e=>e.ended))},getCount(){const e=this.conversations.reduce(((e,t)=>e+(t.ended?0:1)),0);return e>0}}};const qt=(0,ee.Z)(Jt,[["render",$]]);var $t=qt,zt={data(){return{showChat:!1,showPop:!1,user:"",ip:"",stateval:{},unreadMsg:0,botName:"Alex",isLoading:!1}},components:{chatmaintest:$t},methods:{updateUnreadMsg(e){this.unreadMsg=this.unreadMsg+e},toggleChat(){this.showPop=!this.showPop;const e={...this.stateval,state:{...this.stateval.state,toggle:this.showPop}};this.updateState(e)},async checkFirst(){let e=localStorage.getItem("appState");if(null===e){let e={user:{role:"lead",locale:"en",hasConversations:!0},conversations:{byId:{}},state:{page:{name:"home",id:null},toggle:!1}};localStorage.setItem("appState",JSON.stringify(e))}},async updateState(e){this.stateval=e,localStorage.setItem("appState",JSON.stringify(e))},addConversation(e,t){const s={...this.stateval,conversations:{...this.stateval.conversations,byId:{...this.stateval.conversations.byId,[e]:t}}};this.updateState(s)},updateConversation(e,t){const s={...this.stateval,conversations:{...this.stateval.conversations,byId:{...this.stateval.conversations.byId,[e]:{...this.stateval.conversations.byId[e],...t}}}};this.updateState(s)},getConversationBy(e){const t=JSON.parse(localStorage.getItem("appState")),s=t.conversations.byId;return s.hasOwnProperty(e)?s[e]:null},removeConversation(e){const{[e]:t,...s}=this.stateval.conversations.byId,a={...this.stateval,conversations:{...this.stateval.conversations,byId:s}};this.updateState(a)},async get_creat_user(){const e=localStorage.getItem("userId");e?this.user=e:(await fetch("https://api.ipify.org?format=json").then((e=>e.json())).then((({ip:e})=>{this.user=e.split(".").join(""),this.ip=e})),localStorage.setItem("userId",this.user))},async saveConversationId(e){const t=Date.now(),s={fetchState:"partial",read:!0,expire:t,ended:!1};this.addConversation(e,s)},async createNewConvo(){this.isLoading=!0;const e=JSON.parse(localStorage.getItem("appState")),t=e.conversations.byId,s=Object.keys(t).pop(),a=Object.values(t).pop(),o=!a||a.ended;if(o){this.isLoading=!0;let e=await C(this.user);await this.saveConversationId(e),this.isLoading=!1,this.$router.push({name:"conversation",params:{id:e}})}else this.$router.push({name:"conversation",params:{id:s}}),this.isLoading=!1}},async mounted(){this.checkFirst();const e=JSON.parse(localStorage.getItem("appState"))||this.stateval;await this.updateState(e),this.removeConversation("undefined")},async created(){await this.checkFirst(),await this.get_creat_user();const e=JSON.parse(localStorage.getItem("appState"));if(e&&e.hasOwnProperty("state"))this.showPop=e.state.toggle;else{const t={...e,state:{toggle:!1,page:{name:"home",id:null}}};this.updateState(t)}}};const Rt=(0,ee.Z)(zt,[["render",p]]);var Vt=Rt,Wt=(s(9773),s(8957)),Ht=(0,Wt.Rd)();const Zt=document.querySelector("#chatly-app"),Yt=Zt.attachShadow({mode:"open"});Zt.style.display="none",fetch("https://joshijax.github.io/chatlywidget/css/app.css").then((function(e){return e.text()})).then((function(e){const t=document.createElement("style");t.textContent=e,fetch("https://joshijax.github.io/chatlywidget/css/chunk-vendors.css").then((function(e){return e.text()})).then((function(e){(0,a.ri)(Vt).use(Ht).mount(Yt),Yt.prepend(t);const s=document.createElement("style");s.textContent=e,Yt.prepend(s),Zt.style.display="block"}))}))},9252:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAADB0lEQVRogdWZiU3rQBCGOcR9hPsGh0vcGGggJbwSXEJKmBJSAiVQgkt4JVCCS5j3r7RrTYYNJOv1Mx7pkzL77/6zf6IIMFPMPPUT49bb21sC3kEBWFFYLRnXb6y7xQrw+vraBzwm/V8V4OXlhQBPCP2KAGma9gAH0ms8wPPzcw44kLzRAE9PTwngioz8Utce4PHxMQNckayxAA8PDwS4IiO/zLUHuL+/J8AVaS7A3d0dAa5IcwFub28JcEWaC3Bzc0OAK1J/gOvr6w/AYCAHoCe7XgVSngO7/hEtwNXVFVsKOQw9CS0UUp6F06IFuLy8ZIcchp6kFggpz1KLFuDi4oIdchh6klogpDxLLVqA8/Nzdshh6ElqgZDyLLVoAbrdLjvkMPQktUBIeZZatABJkrBDDkNPUguElGepRQtwdnbGDjkMPUktEFKepRYtwOnpKTvkMPQktUBIeZZatAAnJyfskMPQk9QCIeVZatECHB8fs0MOQ09SC4SUZ6lFC3B0dMQOOQx9JrVAMuVZatECHB4esiB1w/A6UVoIifBLpRYtwMHBQQ7YMvRMR2mTkiuvvtSiBdjf3x8AtgwNRd8T2qT0lFcutEG0AHt7eylgwdBg9KT0cSDl0VN6Gi2AqZ2dnU/Ali/Pc3Z3d/tC/xazV583nmLPp1mLGmB7ezsDLPBdIgHv0Aq111AYzezR54yX2ptFD2Bqa2srByxI9WUmLeOhPMtPt44A6ebmZgHYYl7/Cb28Oav95JsSPYCpjY2NDLBiADrjXtzstWe0z9APtVoCmOp0OhlgRQEIjHzWaTS7p/Cc//KIsbYA9jK99fX1ArAHs54rRu41Xr4ZtQYwheGdtbW1d8CBDIzHKP/aA7jCRZLV1VUCfwH/gNlD5sxPvv8tgCxcrrOyssI+jDaJVyMBTC0vL7OPSX0aC7C0tMQ+WhNgcXGRfbQmwMLCAvtoTYD5+Xn20ZoAc3Nz7KM1AWZnZ9lHawLMzMywj9YEmJ6ezgErvv2v/G8LYH6nN38WsuXTrkUP8A8n8+qMtVQDtAAAAABJRU5ErkJggg=="},8538:function(e,t,s){e.exports=s.p+"img/stop.png"}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,a,o,n){if(!a){var i=1/0;for(d=0;d<e.length;d++){a=e[d][0],o=e[d][1],n=e[d][2];for(var r=!0,c=0;c<a.length;c++)(!1&n||i>=n)&&Object.keys(s.O).every((function(e){return s.O[e](a[c])}))?a.splice(c--,1):(r=!1,n<i&&(i=n));if(r){e.splice(d--,1);var l=o();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,o,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.p="/"}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,n,i=a[0],r=a[1],c=a[2],l=0;if(i.some((function(t){return 0!==e[t]}))){for(o in r)s.o(r,o)&&(s.m[o]=r[o]);if(c)var d=c(s)}for(t&&t(a);l<i.length;l++)n=i[l],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},a=self["webpackChunkvue_widget"]=self["webpackChunkvue_widget"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(4506)}));a=s.O(a)})();
//# sourceMappingURL=app.js.map